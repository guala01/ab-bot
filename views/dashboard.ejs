<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>League Dashboard</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: #121212;
            color: #e0e0e0;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #1e1e1e;
            border-radius: 8px;
            border: 1px solid #333;
        }

        header h1 {
            margin: 0;
            font-weight: 600;
            color: #fff;
        }

        .logout-btn {
            color: #ef5350;
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            border: 1px solid #ef5350;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #ef5350;
            color: white;
        }

        h2 {
            color: #fff;
            margin: 30px 0 15px 0;
            font-weight: 500;
            font-size: 1.3em;
        }

        /* Signup Cards Grid */
        .signup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .signup-card {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #333;
            transition: border-color 0.2s;
        }

        .signup-card:hover {
            border-color: #555;
        }

        .signup-card h3 {
            margin: 0 0 8px 0;
            color: #fff;
            font-size: 1.1em;
        }

        .signup-card .meta {
            color: #666;
            font-size: 0.8em;
            margin-bottom: 12px;
        }

        .signup-card .player-count {
            font-size: 2em;
            font-weight: 700;
            color: #66bb6a;
            margin-bottom: 15px;
        }

        .signup-card .player-count span {
            font-size: 0.45em;
            color: #888;
        }

        .signup-card .actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #424242;
            color: #fff;
            border: 1px solid #555;
        }

        .btn-primary:hover {
            background: #555;
        }

        .btn-danger {
            background: #c62828;
            color: white;
        }

        .btn-danger:hover {
            background: #e53935;
        }

        /* Leaderboard Table */
        .table-container {
            background: #1e1e1e;
            border-radius: 8px;
            border: 1px solid #333;
            overflow: hidden;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid #2a2a2a;
        }

        th {
            background: #252525;
            color: #aaa;
            font-weight: 500;
            font-size: 0.85em;
            text-transform: uppercase;
        }

        tr:hover {
            background: #252525;
        }

        .rename-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            padding: 2px 6px;
            opacity: 0.5;
            transition: opacity 0.2s;
        }

        .rename-btn:hover {
            opacity: 1;
        }

        .rename-form {
            display: none;
            margin-top: 8px;
            gap: 5px;
        }

        .rename-form.active {
            display: flex;
        }

        .rename-form input {
            padding: 6px 10px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #2a2a2a;
            color: #eee;
        }

        .rename-form button {
            padding: 6px 12px;
            background: #66bb6a;
            border: none;
            border-radius: 4px;
            color: #121212;
            cursor: pointer;
            font-weight: 600;
        }

        /* Config Section */
        .config-card {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 12px;
            border: 1px solid #333;
        }

        .config-card h3 {
            margin: 0 0 12px 0;
            color: #fff;
            font-size: 1em;
        }

        .tag {
            display: inline-block;
            background: #2a2a2a;
            color: #aaa;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            margin: 2px;
            border: 1px solid #333;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #555;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1> League Dashboard</h1>
            <a href="/logout" class="logout-btn">Logout</a>
        </header>

        <!-- Participation Stats Management -->
        <section>
            <h2>Participation Stats</h2>
            <div class="table-container" style="padding: 20px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="margin: 0;">Games stats</h3>
                    <form action="/update-game-stats" method="POST" style="margin: 0;">
                        <button type="submit" class="btn btn-primary">üîÑ Update from Log File</button>
                    </form>
                </div>
            </div>

            <% if (gameStats && gameStats.length > 0) { %>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Character Name</th>
                            <th>Games Played</th>
                            <th>Total Signups</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% gameStats.forEach(stat => { %>
                            <tr>
                                <td><%= stat.character_name %></td>
                                <td><%= stat.games_played %></td>
                                <td><%= stat.signup_count %></td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
            <% } %>
        </section>

        <!-- Active Signups -->
        <section>
            <h2>üìã Active Signups</h2>
            <% const messageIds=Object.keys(signups); %>
                <% if (messageIds.length===0) { %>
                    <div class="empty-state">No active signups found.</div>
                    <% } else { %>
                        <div class="signup-grid">
                            <% messageIds.forEach(function(msgId) { %>
                                <% const post=signups[msgId]; %>
                                    <div class="signup-card">
                                        <h3>
                                            <%= post.day %>
                                                <button class="rename-btn"
                                                    onclick="toggleDayRename('<%= msgId %>')">‚úèÔ∏è</button>
                                        </h3>
                                        <form id="day-rename-<%= msgId %>" class="rename-form"
                                            action="/api/signup/rename" method="POST">
                                            <input type="hidden" name="messageId" value="<%= msgId %>">
                                            <input type="text" name="dayName" placeholder="New day name"
                                                value="<%= post.day %>">
                                            <button type="submit">Save</button>
                                        </form>
                                        <div class="meta">ID: <%= msgId.substring(0, 8) %>...</div>
                                        <div class="player-count">
                                            <%= post.signups.length %> <span>players</span>
                                        </div>
                                        <div class="actions">
                                            <a href="/manage-teams/<%= msgId %>" class="btn btn-primary">Manage
                                                Teams</a>
                                            <form action="/api/signup/delete" method="POST" style="display:inline;"
                                                onsubmit="return confirm('Delete this signup post?')">
                                                <input type="hidden" name="messageId" value="<%= msgId %>">
                                                <button type="submit" class="btn btn-danger">Delete</button>
                                            </form>
                                        </div>
                                    </div>
                                    <% }); %>
                        </div>
                        <% } %>
        </section>

        <!-- Leaderboard -->
        <section>
            <h2>Discord List</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>Guild</th>
                            <th>Signups</th>
                            <th>Games Played</th>
                            <th>Last Active</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (stats.length===0) { %>
                            <tr>
                                <td colspan="5" style="text-align:center; color:#555;">No stats yet.</td>
                            </tr>
                            <% } %>
                                <% stats.forEach(function(player) { %>
                                    <tr>
                                        <td>
                                            <% let displayName=player.custom_name || player.username; %>
                                                <strong>
                                                    <%= displayName %>
                                                </strong>
                                                <span style="color:#555; font-size:0.85em;">(<%= player.username %>
                                                        )</span>
                                                <button class="rename-btn"
                                                    onclick="toggleRename('<%= player.user_id %>', '<%= player.guild_id %>')">‚úèÔ∏è</button>
                                                <form id="rename-<%= player.user_id %>-<%= player.guild_id %>"
                                                    class="rename-form" action="/api/player/rename" method="POST">
                                                    <input type="hidden" name="userId" value="<%= player.user_id %>">
                                                    <input type="hidden" name="guildId" value="<%= player.guild_id %>">
                                                    <input type="text" name="customName" placeholder="New name"
                                                        value="<%= player.custom_name || '' %>">
                                                    <button type="submit">Save</button>
                                                </form>
                                        </td>
                                        <td>
                                            <%= player.guildName %>
                                        </td>
                                        <td><strong style="color:#66bb6a;">
                                                <%= player.count %>
                                            </strong></td>
                                        <td>
                                            <%= player.games_played %>
                                        </td>
                                        <td style="color:#666;">
                                            <%= player.last_seen %>
                                        </td>
                                    </tr>
                                    <% }); %>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Configurations -->
        <section>
            <h2>‚öôÔ∏è Configurations</h2>
            <% const guildIds=Object.keys(configs); %>
                <% if (guildIds.length===0) { %>
                    <div class="empty-state">No configurations found.</div>
                    <% } %>
                        <% guildIds.forEach(function(gid) { %>
                            <div class="config-card">
                                <h3>
                                    <%= configs[gid].name %>
                                </h3>
                                <% configs[gid].configs.forEach(function(config) { %>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color:#aaa;">
                                            <%= config.day %>:
                                        </strong>
                                        <% JSON.parse(config.ranges).forEach(function(range) { %>
                                            <span class="tag">
                                                <%= range.start %> - <%= range.end %>
                                            </span>
                                            <% }); %>
                                    </div>
                                    <% }); %>
                            </div>
                            <% }); %>
        </section>
    </div>

    <script>
        function toggleRename(userId, guildId) {
            const form = document.getElementById(`rename-${userId}-${guildId}`);
            form.classList.toggle('active');
        }

        function toggleDayRename(msgId) {
            const form = document.getElementById(`day-rename-${msgId}`);
            form.classList.toggle('active');
        }
    </script>
</body>

</html>